/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { ActivatedRoute, NavigationEnd, Router } from '@angular/router';
import { BehaviorSubject } from 'rxjs';
import { distinctUntilChanged, filter } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
var BreadcrumbService = /** @class */ (function () {
    function BreadcrumbService(activatedRoute, router) {
        this.activatedRoute = activatedRoute;
        this.router = router;
        this.baseHref = '/';
        /**
         * dynamicBreadcrumbStore holds information about dynamically updated breadcrumbs.
         * Breadcrumbs can be set from anywhere (component, service) in the app.
         * On every breadcrumb update check this store and use the info if available.
         */
        this.dynamicBreadcrumbStore = [];
        /**
         * breadcrumbList for the current route
         * When breadcrumb info is changed dynamically, check if the currentBreadcrumbs is effected
         * If effected, update the change and emit a new stream
         */
        this.currentBreadcrumbs = [];
        this.previousBreadcrumbs = [];
        /**
         * Breadcrumbs observable to be subscribed by BreadcrumbComponent
         * Emits on every route change OR dynamic update of breadcrumb
         */
        this.breadcrumbs = new BehaviorSubject([]);
        this.breadcrumbs$ = this.breadcrumbs.asObservable();
        this.pathParamPrefix = ':';
        this.pathParamRegexIdentifier = '/:[^/]+';
        this.pathParamRegexReplacer = '/[^/]+';
        this.setBaseBreadcrumb();
        this.detectRouteChanges();
    }
    /**
     * Update breadcrumb label or options for -
     *
     * route (complete route path). route can be passed the same way you define angular routes
     * 1) update label Ex: set('/mentor', 'Mentor'), set('/mentor/:id', 'Mentor Details')
     * 2) change visibility Ex: set('/mentor/:id/edit', { skip: true })
     * 3) add info Ex: set('/mentor/:id/edit', { info: { icon: 'edit', iconColor: 'blue' } })
     * ------------------------ OR -------------------------
     *
     * alias (prefixed with '@'). breadcrumb alias is unique for a route
     * 1) update label Ex: set('@mentor', 'Enabler')
     * 2) change visibility Ex: set('@mentorEdit', { skip: true })
     * 3) add info Ex: set('@mentorEdit', { info: { icon: 'edit', iconColor: 'blue' } })
     */
    /**
     * Update breadcrumb label or options for -
     *
     * route (complete route path). route can be passed the same way you define angular routes
     * 1) update label Ex: set('/mentor', 'Mentor'), set('/mentor/:id', 'Mentor Details')
     * 2) change visibility Ex: set('/mentor/:id/edit', { skip: true })
     * 3) add info Ex: set('/mentor/:id/edit', { info: { icon: 'edit', iconColor: 'blue' } })
     * ------------------------ OR -------------------------
     *
     * alias (prefixed with '\@'). breadcrumb alias is unique for a route
     * 1) update label Ex: set('\@mentor', 'Enabler')
     * 2) change visibility Ex: set('\@mentorEdit', { skip: true })
     * 3) add info Ex: set('\@mentorEdit', { info: { icon: 'edit', iconColor: 'blue' } })
     * @param {?} pathOrAlias
     * @param {?} breadcrumb
     * @return {?}
     */
    BreadcrumbService.prototype.set = /**
     * Update breadcrumb label or options for -
     *
     * route (complete route path). route can be passed the same way you define angular routes
     * 1) update label Ex: set('/mentor', 'Mentor'), set('/mentor/:id', 'Mentor Details')
     * 2) change visibility Ex: set('/mentor/:id/edit', { skip: true })
     * 3) add info Ex: set('/mentor/:id/edit', { info: { icon: 'edit', iconColor: 'blue' } })
     * ------------------------ OR -------------------------
     *
     * alias (prefixed with '\@'). breadcrumb alias is unique for a route
     * 1) update label Ex: set('\@mentor', 'Enabler')
     * 2) change visibility Ex: set('\@mentorEdit', { skip: true })
     * 3) add info Ex: set('\@mentorEdit', { info: { icon: 'edit', iconColor: 'blue' } })
     * @param {?} pathOrAlias
     * @param {?} breadcrumb
     * @return {?}
     */
    function (pathOrAlias, breadcrumb) {
        if (!this.validateArguments(pathOrAlias, breadcrumb)) {
            return;
        }
        if (typeof breadcrumb === 'string') {
            breadcrumb = {
                label: breadcrumb
            };
        }
        if (pathOrAlias.startsWith('@')) {
            this.updateStore(tslib_1.__assign({}, breadcrumb, { alias: pathOrAlias.slice(1) }));
        }
        else {
            /** @type {?} */
            var breadcrumbExtraProps = this.buildRouteRegExp(pathOrAlias);
            this.updateStore(tslib_1.__assign({}, breadcrumb, breadcrumbExtraProps));
        }
    };
    /**
     * @private
     * @return {?}
     */
    BreadcrumbService.prototype.setBaseBreadcrumb = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var baseConfig = this.router.config.find((/**
         * @param {?} pathConfig
         * @return {?}
         */
        function (pathConfig) { return pathConfig.path === ''; }));
        if (baseConfig && baseConfig.data) {
            var _a = this.getBreadcrumbOptions(baseConfig.data), label = _a.label, alias = _a.alias, _b = _a.skip, skip = _b === void 0 ? false : _b, info = _a.info, _c = _a.disable, disable = _c === void 0 ? false : _c;
            /** @type {?} */
            var isAutoGeneratedLabel = false;
            if (typeof label !== 'string' && !label) {
                label = '';
                isAutoGeneratedLabel = true;
            }
            this.baseBreadcrumb = {
                label: label,
                alias: alias,
                skip: skip,
                disable: disable,
                info: info,
                routeLink: this.baseHref,
                isAutoGeneratedLabel: isAutoGeneratedLabel
            };
        }
    };
    /**
     * Whenever route changes build breadcrumb list again
     */
    /**
     * Whenever route changes build breadcrumb list again
     * @private
     * @return {?}
     */
    BreadcrumbService.prototype.detectRouteChanges = /**
     * Whenever route changes build breadcrumb list again
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.router.events
            .pipe(filter((/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return event instanceof NavigationEnd; })), distinctUntilChanged())
            .subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.previousBreadcrumbs = _this.currentBreadcrumbs;
            _this.currentBreadcrumbs = _this.baseBreadcrumb ? [_this.baseBreadcrumb] : [];
            _this.prepareBreadcrumbList(_this.activatedRoute.root, _this.baseHref);
        }));
    };
    /**
     * @private
     * @param {?} activatedRoute
     * @param {?} routeLinkPrefix
     * @return {?}
     */
    BreadcrumbService.prototype.prepareBreadcrumbList = /**
     * @private
     * @param {?} activatedRoute
     * @param {?} routeLinkPrefix
     * @return {?}
     */
    function (activatedRoute, routeLinkPrefix) {
        if (activatedRoute.routeConfig && activatedRoute.routeConfig.path) {
            /** @type {?} */
            var breadcrumbItem = this.prepareBreadcrumbItem(activatedRoute, routeLinkPrefix);
            this.currentBreadcrumbs.push(breadcrumbItem);
            if (activatedRoute.firstChild) {
                return this.prepareBreadcrumbList(activatedRoute.firstChild, breadcrumbItem.routeLink + '/');
            }
        }
        else if (activatedRoute.firstChild) {
            return this.prepareBreadcrumbList(activatedRoute.firstChild, routeLinkPrefix);
        }
        // remove breadcrumb items that needs to be hidden or don't have a label
        /** @type {?} */
        var breadcrumbsToShow = this.currentBreadcrumbs.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return !item.skip; }));
        this.breadcrumbs.next(breadcrumbsToShow);
    };
    /**
     * @private
     * @param {?} activatedRoute
     * @param {?} routeLinkPrefix
     * @return {?}
     */
    BreadcrumbService.prototype.prepareBreadcrumbItem = /**
     * @private
     * @param {?} activatedRoute
     * @param {?} routeLinkPrefix
     * @return {?}
     */
    function (activatedRoute, routeLinkPrefix) {
        var _a = this.parseRouteData(activatedRoute.routeConfig), path = _a.path, breadcrumb = _a.breadcrumb;
        // in case of path param get the resolved for param
        /** @type {?} */
        var resolvedPath = this.resolvePathParam(path, activatedRoute);
        /** @type {?} */
        var routeLink = "" + routeLinkPrefix + resolvedPath;
        var _b = this.getFromStore(breadcrumb.alias, routeLink), label = _b.label, alias = _b.alias, skip = _b.skip, disable = _b.disable, info = _b.info;
        /** @type {?} */
        var isAutoGeneratedLabel = false;
        if (typeof label !== 'string') {
            if (typeof breadcrumb.label === 'string') {
                label = breadcrumb.label;
            }
            else {
                label = resolvedPath;
                isAutoGeneratedLabel = true;
            }
        }
        return tslib_1.__assign({ label: label, alias: alias || breadcrumb.alias, skip: skip || breadcrumb.skip, disable: disable || breadcrumb.disable, info: info || breadcrumb.info, routeLink: routeLink,
            isAutoGeneratedLabel: isAutoGeneratedLabel }, this.resolveQueryParam(routeLink, activatedRoute));
    };
    /**
     * For a specific route, breadcrumb can be defined either on parent data OR it's child(which has empty path) data
     * When both are defined, child takes precedence
     *
     * Ex: Below we are setting breadcrumb on both parent and child.
     * So, child takes precedence and "Defined On Child" is displayed for the route 'home'
     * { path: 'home', loadChildren: './home/home.module#HomeModule' , data: {breadcrumb: "Defined On Module"}}
     *                                                AND
     * children: [
     *   { path: '', component: ShowUserComponent, data: {breadcrumb: "Defined On Child" }
     * ]
     */
    /**
     * For a specific route, breadcrumb can be defined either on parent data OR it's child(which has empty path) data
     * When both are defined, child takes precedence
     *
     * Ex: Below we are setting breadcrumb on both parent and child.
     * So, child takes precedence and "Defined On Child" is displayed for the route 'home'
     * { path: 'home', loadChildren: './home/home.module#HomeModule' , data: {breadcrumb: "Defined On Module"}}
     *                                                AND
     * children: [
     *   { path: '', component: ShowUserComponent, data: {breadcrumb: "Defined On Child" }
     * ]
     * @private
     * @param {?} routeConfig
     * @return {?}
     */
    BreadcrumbService.prototype.parseRouteData = /**
     * For a specific route, breadcrumb can be defined either on parent data OR it's child(which has empty path) data
     * When both are defined, child takes precedence
     *
     * Ex: Below we are setting breadcrumb on both parent and child.
     * So, child takes precedence and "Defined On Child" is displayed for the route 'home'
     * { path: 'home', loadChildren: './home/home.module#HomeModule' , data: {breadcrumb: "Defined On Module"}}
     *                                                AND
     * children: [
     *   { path: '', component: ShowUserComponent, data: {breadcrumb: "Defined On Child" }
     * ]
     * @private
     * @param {?} routeConfig
     * @return {?}
     */
    function (routeConfig) {
        var path = routeConfig.path, _a = routeConfig.data, data = _a === void 0 ? {} : _a;
        /** @type {?} */
        var breadcrumb = this.mergeWithBaseChildData(routeConfig, tslib_1.__assign({}, data));
        return { path: path, breadcrumb: breadcrumb };
    };
    /**
     * @private
     * @param {?} breadcrumbAlias
     * @param {?} routeLink
     * @return {?}
     */
    BreadcrumbService.prototype.getFromStore = /**
     * @private
     * @param {?} breadcrumbAlias
     * @param {?} routeLink
     * @return {?}
     */
    function (breadcrumbAlias, routeLink) {
        /** @type {?} */
        var matchingItem;
        if (breadcrumbAlias) {
            matchingItem = this.dynamicBreadcrumbStore.find((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.alias === breadcrumbAlias; }));
        }
        if (!matchingItem && routeLink) {
            matchingItem = this.dynamicBreadcrumbStore.find((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                return (item.routeLink && item.routeLink === routeLink) || (item.routeRegex && new RegExp(item.routeRegex).test(routeLink + '/'));
            }));
        }
        return matchingItem || {};
    };
    /**
     * To update breadcrumb label for a route with path param, we need regex that matches route.
     * Instead of user providing regex, we help in preparing regex dynamically
     *
     * Ex: route declaration - path: '/mentor/:id'
     * breadcrumbService.set('/mentor/:id', 'Uday');
     * '/mentor/2' OR 'mentor/ada' we should use 'Uday' as label
     *
     * regex string is built, if route has path params(contains with ':')
     */
    /**
     * To update breadcrumb label for a route with path param, we need regex that matches route.
     * Instead of user providing regex, we help in preparing regex dynamically
     *
     * Ex: route declaration - path: '/mentor/:id'
     * breadcrumbService.set('/mentor/:id', 'Uday');
     * '/mentor/2' OR 'mentor/ada' we should use 'Uday' as label
     *
     * regex string is built, if route has path params(contains with ':')
     * @private
     * @param {?} path
     * @return {?}
     */
    BreadcrumbService.prototype.buildRouteRegExp = /**
     * To update breadcrumb label for a route with path param, we need regex that matches route.
     * Instead of user providing regex, we help in preparing regex dynamically
     *
     * Ex: route declaration - path: '/mentor/:id'
     * breadcrumbService.set('/mentor/:id', 'Uday');
     * '/mentor/2' OR 'mentor/ada' we should use 'Uday' as label
     *
     * regex string is built, if route has path params(contains with ':')
     * @private
     * @param {?} path
     * @return {?}
     */
    function (path) {
        // ensure leading slash is provided in the path
        if (!path.startsWith('/')) {
            path = '/' + path;
        }
        if (path.includes(this.pathParamPrefix)) {
            // replace mathing path param with a regex
            // '/mentor/:id' becomes '/mentor/[^/]', which further will be matched in updateStore
            /** @type {?} */
            var routeRegex = path.replace(new RegExp(this.pathParamRegexIdentifier, 'g'), this.pathParamRegexReplacer);
            return { routeRegex: routeRegex };
        }
        else {
            return { routeLink: path };
        }
    };
    /**
     * Update current breadcrumb definition and emit a new stream of breadcrumbs
     * Also update the store to reuse dynamic declarations
     */
    /**
     * Update current breadcrumb definition and emit a new stream of breadcrumbs
     * Also update the store to reuse dynamic declarations
     * @private
     * @param {?} breadcrumb
     * @return {?}
     */
    BreadcrumbService.prototype.updateStore = /**
     * Update current breadcrumb definition and emit a new stream of breadcrumbs
     * Also update the store to reuse dynamic declarations
     * @private
     * @param {?} breadcrumb
     * @return {?}
     */
    function (breadcrumb) {
        var _a = this.getBreadcrumbIndexes(breadcrumb), breadcrumbItemIndex = _a.breadcrumbItemIndex, storeItemIndex = _a.storeItemIndex;
        // if breadcrumb is present in current breadcrumbs update it and emit new stream
        if (breadcrumbItemIndex > -1) {
            this.currentBreadcrumbs[breadcrumbItemIndex] = tslib_1.__assign({}, this.currentBreadcrumbs[breadcrumbItemIndex], breadcrumb);
            /** @type {?} */
            var breadcrumbsToShow = this.currentBreadcrumbs.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return !item.skip; }));
            this.breadcrumbs.next(tslib_1.__spread(breadcrumbsToShow));
        }
        // If the store already has this route definition update it, else add
        if (storeItemIndex > -1) {
            this.dynamicBreadcrumbStore[storeItemIndex] = tslib_1.__assign({}, this.dynamicBreadcrumbStore[storeItemIndex], breadcrumb);
        }
        else {
            this.dynamicBreadcrumbStore.push(breadcrumb);
        }
    };
    /**
     * @private
     * @param {?} breadcrumb
     * @return {?}
     */
    BreadcrumbService.prototype.getBreadcrumbIndexes = /**
     * @private
     * @param {?} breadcrumb
     * @return {?}
     */
    function (breadcrumb) {
        var alias = breadcrumb.alias, routeLink = breadcrumb.routeLink, routeRegex = breadcrumb.routeRegex;
        /** @type {?} */
        var indexMap = {};
        // identify macthing breadcrumb and store item
        if (alias) {
            indexMap = this.getBreadcrumbIndexesByType('alias', alias);
        }
        else if (routeLink) {
            indexMap = this.getBreadcrumbIndexesByType('routeLink', routeLink);
        }
        else if (routeRegex) {
            indexMap = this.getBreadcrumbIndexesByType('routeRegex', routeRegex);
        }
        return indexMap;
    };
    /**
     * @private
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    BreadcrumbService.prototype.getBreadcrumbIndexesByType = /**
     * @private
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    function (key, value) {
        /** @type {?} */
        var breadcrumbItemIndex;
        if (key !== 'routeRegex') {
            breadcrumbItemIndex = this.currentBreadcrumbs.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return value === item[key]; }));
        }
        else {
            breadcrumbItemIndex = this.currentBreadcrumbs.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return new RegExp(value).test(item.routeLink); }));
        }
        /** @type {?} */
        var storeItemIndex = this.dynamicBreadcrumbStore.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return value === item[key]; }));
        return { breadcrumbItemIndex: breadcrumbItemIndex, storeItemIndex: storeItemIndex };
    };
    /**
     * @private
     * @param {?} path
     * @param {?} activatedRoute
     * @return {?}
     */
    BreadcrumbService.prototype.resolvePathParam = /**
     * @private
     * @param {?} path
     * @param {?} activatedRoute
     * @return {?}
     */
    function (path, activatedRoute) {
        // if the path segment is a route param, read the param value from url
        if (path.startsWith(this.pathParamPrefix)) {
            return activatedRoute.snapshot.params[path.slice(1)];
        }
        return path;
    };
    /**
     * @private
     * @param {?} routeLink
     * @param {?} activatedRoute
     * @return {?}
     */
    BreadcrumbService.prototype.resolveQueryParam = /**
     * @private
     * @param {?} routeLink
     * @param {?} activatedRoute
     * @return {?}
     */
    function (routeLink, activatedRoute) {
        /** @type {?} */
        var previousBreadcrumb = this.previousBreadcrumbs.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.routeLink === routeLink; })) || {};
        var _a = activatedRoute.snapshot, queryParams = _a.queryParams, fragment = _a.fragment;
        return {
            queryParams: Object.keys(queryParams).length > 0 ? tslib_1.__assign({}, queryParams) : previousBreadcrumb.queryParams,
            fragment: fragment || previousBreadcrumb.fragment
        };
    };
    /**
     * get empty children of a module or Component. Empty child is the one with path: ''
     * When parent and it's children (that has empty route path) define data
     * merge them both with child taking precedence
     */
    /**
     * get empty children of a module or Component. Empty child is the one with path: ''
     * When parent and it's children (that has empty route path) define data
     * merge them both with child taking precedence
     * @private
     * @param {?} routeConfig
     * @param {?} data
     * @return {?}
     */
    BreadcrumbService.prototype.mergeWithBaseChildData = /**
     * get empty children of a module or Component. Empty child is the one with path: ''
     * When parent and it's children (that has empty route path) define data
     * merge them both with child taking precedence
     * @private
     * @param {?} routeConfig
     * @param {?} data
     * @return {?}
     */
    function (routeConfig, data) {
        if (!routeConfig) {
            return this.getBreadcrumbOptions(data);
        }
        /** @type {?} */
        var baseChild;
        if (routeConfig.loadChildren) {
            // To handle a module with empty child route
            baseChild = routeConfig._loadedConfig.routes.find((/**
             * @param {?} route
             * @return {?}
             */
            function (route) { return route.path === ''; }));
        }
        else if (routeConfig.children) {
            // To handle a component with empty child route
            baseChild = routeConfig.children.find((/**
             * @param {?} route
             * @return {?}
             */
            function (route) { return route.path === ''; }));
        }
        return baseChild && baseChild.data
            ? this.mergeWithBaseChildData(baseChild, tslib_1.__assign({}, this.getBreadcrumbOptions(data), this.getBreadcrumbOptions(baseChild.data)))
            : this.getBreadcrumbOptions(data);
    };
    /**
     * @private
     * @param {?} pathOrAlias
     * @param {?} breadcrumb
     * @return {?}
     */
    BreadcrumbService.prototype.validateArguments = /**
     * @private
     * @param {?} pathOrAlias
     * @param {?} breadcrumb
     * @return {?}
     */
    function (pathOrAlias, breadcrumb) {
        if (pathOrAlias === null || pathOrAlias === undefined) {
            console.error('Invalid first argument. Please pass a route path or a breadcrumb alias.');
            return false;
        }
        else if (breadcrumb === null || breadcrumb === undefined) {
            console.error('Invalid second argument. Please pass a string or an Object with breadcrumb options.');
            return false;
        }
        return true;
    };
    /**
     * breadcrumb can be passed a label or an options object
     * If passed as a string convert to breadcrumb options object
     */
    /**
     * breadcrumb can be passed a label or an options object
     * If passed as a string convert to breadcrumb options object
     * @private
     * @param {?} data
     * @return {?}
     */
    BreadcrumbService.prototype.getBreadcrumbOptions = /**
     * breadcrumb can be passed a label or an options object
     * If passed as a string convert to breadcrumb options object
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var breadcrumb = data.breadcrumb;
        if (typeof breadcrumb === 'string' || !breadcrumb) {
            breadcrumb = {
                label: breadcrumb
            };
        }
        return breadcrumb;
    };
    BreadcrumbService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    BreadcrumbService.ctorParameters = function () { return [
        { type: ActivatedRoute },
        { type: Router }
    ]; };
    /** @nocollapse */ BreadcrumbService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function BreadcrumbService_Factory() { return new BreadcrumbService(i0.ɵɵinject(i1.ActivatedRoute), i0.ɵɵinject(i1.Router)); }, token: BreadcrumbService, providedIn: "root" });
    return BreadcrumbService;
}());
export { BreadcrumbService };
if (false) {
    /**
     * breadcrumb label for base OR root path. Usually, this can be set as 'Home'
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.baseBreadcrumb;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.baseHref;
    /**
     * dynamicBreadcrumbStore holds information about dynamically updated breadcrumbs.
     * Breadcrumbs can be set from anywhere (component, service) in the app.
     * On every breadcrumb update check this store and use the info if available.
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.dynamicBreadcrumbStore;
    /**
     * breadcrumbList for the current route
     * When breadcrumb info is changed dynamically, check if the currentBreadcrumbs is effected
     * If effected, update the change and emit a new stream
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.currentBreadcrumbs;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.previousBreadcrumbs;
    /**
     * Breadcrumbs observable to be subscribed by BreadcrumbComponent
     * Emits on every route change OR dynamic update of breadcrumb
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.breadcrumbs;
    /** @type {?} */
    BreadcrumbService.prototype.breadcrumbs$;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.pathParamPrefix;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.pathParamRegexIdentifier;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.pathParamRegexReplacer;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbService.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJlYWRjcnVtYi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8veG5nLWJyZWFkY3J1bWIvIiwic291cmNlcyI6WyJsaWIvYnJlYWRjcnVtYi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7O0FBRzlEO0lBcUNFLDJCQUFvQixjQUE4QixFQUFVLE1BQWM7UUFBdEQsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQTVCbEUsYUFBUSxHQUFHLEdBQUcsQ0FBQzs7Ozs7O1FBT2YsMkJBQXNCLEdBQWlCLEVBQUUsQ0FBQzs7Ozs7O1FBTzFDLHVCQUFrQixHQUFpQixFQUFFLENBQUM7UUFDdEMsd0JBQW1CLEdBQWlCLEVBQUUsQ0FBQzs7Ozs7UUFNdkMsZ0JBQVcsR0FBRyxJQUFJLGVBQWUsQ0FBZSxFQUFFLENBQUMsQ0FBQztRQUNyRCxpQkFBWSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxFQUFFLENBQUM7UUFFOUMsb0JBQWUsR0FBRyxHQUFHLENBQUM7UUFDdEIsNkJBQXdCLEdBQUcsU0FBUyxDQUFDO1FBQ3JDLDJCQUFzQixHQUFHLFFBQVEsQ0FBQztRQUd4QyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7T0FhRzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBQ0gsK0JBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBQUgsVUFBSSxXQUFtQixFQUFFLFVBQStCO1FBQ3RELElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxFQUFFLFVBQVUsQ0FBQyxFQUFFO1lBQ3BELE9BQU87U0FDUjtRQUVELElBQUksT0FBTyxVQUFVLEtBQUssUUFBUSxFQUFFO1lBQ2xDLFVBQVUsR0FBRztnQkFDWCxLQUFLLEVBQUUsVUFBVTthQUNsQixDQUFDO1NBQ0g7UUFFRCxJQUFJLFdBQVcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDL0IsSUFBSSxDQUFDLFdBQVcsc0JBQU0sVUFBVSxJQUFFLEtBQUssRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFHLENBQUM7U0FDbEU7YUFBTTs7Z0JBQ0Msb0JBQW9CLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztZQUMvRCxJQUFJLENBQUMsV0FBVyxzQkFBTSxVQUFVLEVBQUssb0JBQW9CLEVBQUcsQ0FBQztTQUM5RDtJQUNILENBQUM7Ozs7O0lBRU8sNkNBQWlCOzs7O0lBQXpCOztZQUNRLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJOzs7O1FBQUMsVUFBQSxVQUFVLElBQUksT0FBQSxVQUFVLENBQUMsSUFBSSxLQUFLLEVBQUUsRUFBdEIsQ0FBc0IsRUFBQztRQUNoRixJQUFJLFVBQVUsSUFBSSxVQUFVLENBQUMsSUFBSSxFQUFFO1lBQzdCLElBQUEsK0NBQWtHLEVBQWhHLGdCQUFLLEVBQUUsZ0JBQUssRUFBRSxZQUFZLEVBQVosaUNBQVksRUFBRSxjQUFJLEVBQUUsZUFBZSxFQUFmLG9DQUE4RDs7Z0JBRWxHLG9CQUFvQixHQUFHLEtBQUs7WUFDaEMsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ3ZDLEtBQUssR0FBRyxFQUFFLENBQUM7Z0JBQ1gsb0JBQW9CLEdBQUcsSUFBSSxDQUFDO2FBQzdCO1lBRUQsSUFBSSxDQUFDLGNBQWMsR0FBRztnQkFDcEIsS0FBSyxPQUFBO2dCQUNMLEtBQUssT0FBQTtnQkFDTCxJQUFJLE1BQUE7Z0JBQ0osT0FBTyxTQUFBO2dCQUNQLElBQUksTUFBQTtnQkFDSixTQUFTLEVBQUUsSUFBSSxDQUFDLFFBQVE7Z0JBQ3hCLG9CQUFvQixzQkFBQTthQUNyQixDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRUQ7O09BRUc7Ozs7OztJQUNLLDhDQUFrQjs7Ozs7SUFBMUI7UUFBQSxpQkFZQztRQVhDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTthQUNmLElBQUksQ0FDSCxNQUFNOzs7O1FBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLFlBQVksYUFBYSxFQUE5QixDQUE4QixFQUFDLEVBQy9DLG9CQUFvQixFQUFFLENBQ3ZCO2FBQ0EsU0FBUzs7OztRQUFDLFVBQUEsS0FBSztZQUNkLEtBQUksQ0FBQyxtQkFBbUIsR0FBRyxLQUFJLENBQUMsa0JBQWtCLENBQUM7WUFFbkQsS0FBSSxDQUFDLGtCQUFrQixHQUFHLEtBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDM0UsS0FBSSxDQUFDLHFCQUFxQixDQUFDLEtBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLEtBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0RSxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7Ozs7SUFFTyxpREFBcUI7Ozs7OztJQUE3QixVQUE4QixjQUE4QixFQUFFLGVBQXVCO1FBQ25GLElBQUksY0FBYyxDQUFDLFdBQVcsSUFBSSxjQUFjLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRTs7Z0JBQzNELGNBQWMsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxFQUFFLGVBQWUsQ0FBQztZQUNsRixJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBRTdDLElBQUksY0FBYyxDQUFDLFVBQVUsRUFBRTtnQkFDN0IsT0FBTyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLFVBQVUsRUFBRSxjQUFjLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxDQUFDO2FBQzlGO1NBQ0Y7YUFBTSxJQUFJLGNBQWMsQ0FBQyxVQUFVLEVBQUU7WUFDcEMsT0FBTyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLFVBQVUsRUFBRSxlQUFlLENBQUMsQ0FBQztTQUMvRTs7O1lBRUssaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU07Ozs7UUFBQyxVQUFBLElBQUksSUFBSSxPQUFBLENBQUMsSUFBSSxDQUFDLElBQUksRUFBVixDQUFVLEVBQUM7UUFFNUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUMzQyxDQUFDOzs7Ozs7O0lBRU8saURBQXFCOzs7Ozs7SUFBN0IsVUFBOEIsY0FBOEIsRUFBRSxlQUF1QjtRQUM3RSxJQUFBLG9EQUFzRSxFQUFwRSxjQUFJLEVBQUUsMEJBQThEOzs7WUFHdEUsWUFBWSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDOztZQUMxRCxTQUFTLEdBQUcsS0FBRyxlQUFlLEdBQUcsWUFBYztRQUVqRCxJQUFBLG1EQUFzRixFQUFwRixnQkFBSyxFQUFFLGdCQUFLLEVBQUUsY0FBSSxFQUFFLG9CQUFPLEVBQUUsY0FBdUQ7O1lBQ3RGLG9CQUFvQixHQUFHLEtBQUs7UUFFaEMsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDN0IsSUFBSSxPQUFPLFVBQVUsQ0FBQyxLQUFLLEtBQUssUUFBUSxFQUFFO2dCQUN4QyxLQUFLLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQzthQUMxQjtpQkFBTTtnQkFDTCxLQUFLLEdBQUcsWUFBWSxDQUFDO2dCQUNyQixvQkFBb0IsR0FBRyxJQUFJLENBQUM7YUFDN0I7U0FDRjtRQUVELDBCQUNFLEtBQUssT0FBQSxFQUNMLEtBQUssRUFBRSxLQUFLLElBQUksVUFBVSxDQUFDLEtBQUssRUFDaEMsSUFBSSxFQUFFLElBQUksSUFBSSxVQUFVLENBQUMsSUFBSSxFQUM3QixPQUFPLEVBQUUsT0FBTyxJQUFJLFVBQVUsQ0FBQyxPQUFPLEVBQ3RDLElBQUksRUFBRSxJQUFJLElBQUksVUFBVSxDQUFDLElBQUksRUFDN0IsU0FBUyxXQUFBO1lBQ1Qsb0JBQW9CLHNCQUFBLElBQ2pCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLEVBQUUsY0FBYyxDQUFDLEVBQ3BEO0lBQ0osQ0FBQztJQUVEOzs7Ozs7Ozs7OztPQVdHOzs7Ozs7Ozs7Ozs7Ozs7O0lBQ0ssMENBQWM7Ozs7Ozs7Ozs7Ozs7OztJQUF0QixVQUF1QixXQUFXO1FBQ3hCLElBQUEsdUJBQUksRUFBRSxxQkFBUyxFQUFULDhCQUFTOztZQUNqQixVQUFVLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsdUJBQU8sSUFBSSxFQUFHO1FBRXhFLE9BQU8sRUFBRSxJQUFJLE1BQUEsRUFBRSxVQUFVLFlBQUEsRUFBRSxDQUFDO0lBQzlCLENBQUM7Ozs7Ozs7SUFFTyx3Q0FBWTs7Ozs7O0lBQXBCLFVBQXFCLGVBQXVCLEVBQUUsU0FBaUI7O1lBQ3pELFlBQVk7UUFDaEIsSUFBSSxlQUFlLEVBQUU7WUFDbkIsWUFBWSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJOzs7O1lBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsS0FBSyxLQUFLLGVBQWUsRUFBOUIsQ0FBOEIsRUFBQyxDQUFDO1NBQ3pGO1FBRUQsSUFBSSxDQUFDLFlBQVksSUFBSSxTQUFTLEVBQUU7WUFDOUIsWUFBWSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJOzs7O1lBQUMsVUFBQSxJQUFJO2dCQUNsRCxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3BJLENBQUMsRUFBQyxDQUFDO1NBQ0o7UUFFRCxPQUFPLFlBQVksSUFBSSxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVEOzs7Ozs7Ozs7T0FTRzs7Ozs7Ozs7Ozs7Ozs7SUFDSyw0Q0FBZ0I7Ozs7Ozs7Ozs7Ozs7SUFBeEIsVUFBeUIsSUFBSTtRQUMzQiwrQ0FBK0M7UUFDL0MsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDekIsSUFBSSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7U0FDbkI7UUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFOzs7O2dCQUdqQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixDQUFDO1lBQzVHLE9BQU8sRUFBRSxVQUFVLFlBQUEsRUFBRSxDQUFDO1NBQ3ZCO2FBQU07WUFDTCxPQUFPLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDO1NBQzVCO0lBQ0gsQ0FBQztJQUVEOzs7T0FHRzs7Ozs7Ozs7SUFDSyx1Q0FBVzs7Ozs7OztJQUFuQixVQUFvQixVQUFVO1FBQ3RCLElBQUEsMENBQStFLEVBQTdFLDRDQUFtQixFQUFFLGtDQUF3RDtRQUVyRixnRkFBZ0Y7UUFDaEYsSUFBSSxtQkFBbUIsR0FBRyxDQUFDLENBQUMsRUFBRTtZQUM1QixJQUFJLENBQUMsa0JBQWtCLENBQUMsbUJBQW1CLENBQUMsd0JBQVEsSUFBSSxDQUFDLGtCQUFrQixDQUFDLG1CQUFtQixDQUFDLEVBQUssVUFBVSxDQUFFLENBQUM7O2dCQUM1RyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTTs7OztZQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFWLENBQVUsRUFBQztZQUM1RSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksa0JBQUssaUJBQWlCLEVBQUUsQ0FBQztTQUMvQztRQUVELHFFQUFxRTtRQUNyRSxJQUFJLGNBQWMsR0FBRyxDQUFDLENBQUMsRUFBRTtZQUN2QixJQUFJLENBQUMsc0JBQXNCLENBQUMsY0FBYyxDQUFDLHdCQUFRLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxjQUFjLENBQUMsRUFBSyxVQUFVLENBQUUsQ0FBQztTQUNqSDthQUFNO1lBQ0wsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUM5QztJQUNILENBQUM7Ozs7OztJQUVPLGdEQUFvQjs7Ozs7SUFBNUIsVUFBNkIsVUFBVTtRQUM3QixJQUFBLHdCQUFLLEVBQUUsZ0NBQVMsRUFBRSxrQ0FBVTs7WUFDaEMsUUFBUSxHQUFHLEVBQUU7UUFDakIsOENBQThDO1FBQzlDLElBQUksS0FBSyxFQUFFO1lBQ1QsUUFBUSxHQUFHLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDNUQ7YUFBTSxJQUFJLFNBQVMsRUFBRTtZQUNwQixRQUFRLEdBQUcsSUFBSSxDQUFDLDBCQUEwQixDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQztTQUNwRTthQUFNLElBQUksVUFBVSxFQUFFO1lBQ3JCLFFBQVEsR0FBRyxJQUFJLENBQUMsMEJBQTBCLENBQUMsWUFBWSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1NBQ3RFO1FBQ0QsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQzs7Ozs7OztJQUVPLHNEQUEwQjs7Ozs7O0lBQWxDLFVBQW1DLEdBQVcsRUFBRSxLQUFhOztZQUN2RCxtQkFBMkI7UUFDL0IsSUFBSSxHQUFHLEtBQUssWUFBWSxFQUFFO1lBQ3hCLG1CQUFtQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxLQUFLLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFuQixDQUFtQixFQUFDLENBQUM7U0FDdEY7YUFBTTtZQUNMLG1CQUFtQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUF0QyxDQUFzQyxFQUFDLENBQUM7U0FDekc7O1lBQ0ssY0FBYyxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTOzs7O1FBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxLQUFLLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFuQixDQUFtQixFQUFDO1FBRXpGLE9BQU8sRUFBRSxtQkFBbUIscUJBQUEsRUFBRSxjQUFjLGdCQUFBLEVBQUUsQ0FBQztJQUNqRCxDQUFDOzs7Ozs7O0lBRU8sNENBQWdCOzs7Ozs7SUFBeEIsVUFBeUIsSUFBWSxFQUFFLGNBQThCO1FBQ25FLHNFQUFzRTtRQUN0RSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFO1lBQ3pDLE9BQU8sY0FBYyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3REO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOzs7Ozs7O0lBRU8sNkNBQWlCOzs7Ozs7SUFBekIsVUFBMEIsU0FBaUIsRUFBRSxjQUE4Qjs7WUFDbkUsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUk7Ozs7UUFBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxTQUFTLEtBQUssU0FBUyxFQUE1QixDQUE0QixFQUFDLElBQUksRUFBRTtRQUM5RixJQUFBLDRCQUFtRCxFQUFqRCw0QkFBVyxFQUFFLHNCQUFvQztRQUV6RCxPQUFPO1lBQ0wsV0FBVyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLHNCQUFNLFdBQVcsRUFBRyxDQUFDLENBQUMsa0JBQWtCLENBQUMsV0FBVztZQUN0RyxRQUFRLEVBQUUsUUFBUSxJQUFJLGtCQUFrQixDQUFDLFFBQVE7U0FDbEQsQ0FBQztJQUNKLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7Ozs7O0lBQ0ssa0RBQXNCOzs7Ozs7Ozs7SUFBOUIsVUFBK0IsV0FBVyxFQUFFLElBQUk7UUFDOUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNoQixPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN4Qzs7WUFFRyxTQUFTO1FBQ2IsSUFBSSxXQUFXLENBQUMsWUFBWSxFQUFFO1lBQzVCLDRDQUE0QztZQUM1QyxTQUFTLEdBQUcsV0FBVyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSTs7OztZQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLElBQUksS0FBSyxFQUFFLEVBQWpCLENBQWlCLEVBQUMsQ0FBQztTQUMvRTthQUFNLElBQUksV0FBVyxDQUFDLFFBQVEsRUFBRTtZQUMvQiwrQ0FBK0M7WUFDL0MsU0FBUyxHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSTs7OztZQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLElBQUksS0FBSyxFQUFFLEVBQWpCLENBQWlCLEVBQUMsQ0FBQztTQUNuRTtRQUVELE9BQU8sU0FBUyxJQUFJLFNBQVMsQ0FBQyxJQUFJO1lBQ2hDLENBQUMsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsU0FBUyx1QkFDaEMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxFQUMvQixJQUFJLENBQUMsb0JBQW9CLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUM1QztZQUNKLENBQUMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdEMsQ0FBQzs7Ozs7OztJQUVPLDZDQUFpQjs7Ozs7O0lBQXpCLFVBQTBCLFdBQVcsRUFBRSxVQUFVO1FBQy9DLElBQUksV0FBVyxLQUFLLElBQUksSUFBSSxXQUFXLEtBQUssU0FBUyxFQUFFO1lBQ3JELE9BQU8sQ0FBQyxLQUFLLENBQUMseUVBQXlFLENBQUMsQ0FBQztZQUN6RixPQUFPLEtBQUssQ0FBQztTQUNkO2FBQU0sSUFBSSxVQUFVLEtBQUssSUFBSSxJQUFJLFVBQVUsS0FBSyxTQUFTLEVBQUU7WUFDMUQsT0FBTyxDQUFDLEtBQUssQ0FBQyxxRkFBcUYsQ0FBQyxDQUFDO1lBQ3JHLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7O09BR0c7Ozs7Ozs7O0lBQ0ssZ0RBQW9COzs7Ozs7O0lBQTVCLFVBQTZCLElBQUk7UUFDekIsSUFBQSw0QkFBVTtRQUNoQixJQUFJLE9BQU8sVUFBVSxLQUFLLFFBQVEsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNqRCxVQUFVLEdBQUc7Z0JBQ1gsS0FBSyxFQUFFLFVBQVU7YUFDbEIsQ0FBQztTQUNIO1FBQ0QsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQzs7Z0JBblZGLFVBQVUsU0FBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7Ozs7Z0JBUFEsY0FBYztnQkFBaUIsTUFBTTs7OzRCQUQ5QztDQTBWQyxBQXBWRCxJQW9WQztTQWpWWSxpQkFBaUI7Ozs7Ozs7SUFJNUIsMkNBQW1DOzs7OztJQUVuQyxxQ0FBdUI7Ozs7Ozs7O0lBT3ZCLG1EQUFrRDs7Ozs7Ozs7SUFPbEQsK0NBQThDOzs7OztJQUM5QyxnREFBK0M7Ozs7Ozs7SUFNL0Msd0NBQTREOztJQUM1RCx5Q0FBc0Q7Ozs7O0lBRXRELDRDQUE4Qjs7Ozs7SUFDOUIscURBQTZDOzs7OztJQUM3QyxtREFBMEM7Ozs7O0lBRTlCLDJDQUFzQzs7Ozs7SUFBRSxtQ0FBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgTmF2aWdhdGlvbkVuZCwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGlzdGluY3RVbnRpbENoYW5nZWQsIGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEJyZWFkY3J1bWIgfSBmcm9tICcuL2JyZWFkY3J1bWInO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBCcmVhZGNydW1iU2VydmljZSB7XG4gIC8qKlxuICAgKiBicmVhZGNydW1iIGxhYmVsIGZvciBiYXNlIE9SIHJvb3QgcGF0aC4gVXN1YWxseSwgdGhpcyBjYW4gYmUgc2V0IGFzICdIb21lJ1xuICAgKi9cbiAgcHJpdmF0ZSBiYXNlQnJlYWRjcnVtYjogQnJlYWRjcnVtYjtcblxuICBwcml2YXRlIGJhc2VIcmVmID0gJy8nO1xuXG4gIC8qKlxuICAgKiBkeW5hbWljQnJlYWRjcnVtYlN0b3JlIGhvbGRzIGluZm9ybWF0aW9uIGFib3V0IGR5bmFtaWNhbGx5IHVwZGF0ZWQgYnJlYWRjcnVtYnMuXG4gICAqIEJyZWFkY3J1bWJzIGNhbiBiZSBzZXQgZnJvbSBhbnl3aGVyZSAoY29tcG9uZW50LCBzZXJ2aWNlKSBpbiB0aGUgYXBwLlxuICAgKiBPbiBldmVyeSBicmVhZGNydW1iIHVwZGF0ZSBjaGVjayB0aGlzIHN0b3JlIGFuZCB1c2UgdGhlIGluZm8gaWYgYXZhaWxhYmxlLlxuICAgKi9cbiAgcHJpdmF0ZSBkeW5hbWljQnJlYWRjcnVtYlN0b3JlOiBCcmVhZGNydW1iW10gPSBbXTtcblxuICAvKipcbiAgICogYnJlYWRjcnVtYkxpc3QgZm9yIHRoZSBjdXJyZW50IHJvdXRlXG4gICAqIFdoZW4gYnJlYWRjcnVtYiBpbmZvIGlzIGNoYW5nZWQgZHluYW1pY2FsbHksIGNoZWNrIGlmIHRoZSBjdXJyZW50QnJlYWRjcnVtYnMgaXMgZWZmZWN0ZWRcbiAgICogSWYgZWZmZWN0ZWQsIHVwZGF0ZSB0aGUgY2hhbmdlIGFuZCBlbWl0IGEgbmV3IHN0cmVhbVxuICAgKi9cbiAgcHJpdmF0ZSBjdXJyZW50QnJlYWRjcnVtYnM6IEJyZWFkY3J1bWJbXSA9IFtdO1xuICBwcml2YXRlIHByZXZpb3VzQnJlYWRjcnVtYnM6IEJyZWFkY3J1bWJbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiBCcmVhZGNydW1icyBvYnNlcnZhYmxlIHRvIGJlIHN1YnNjcmliZWQgYnkgQnJlYWRjcnVtYkNvbXBvbmVudFxuICAgKiBFbWl0cyBvbiBldmVyeSByb3V0ZSBjaGFuZ2UgT1IgZHluYW1pYyB1cGRhdGUgb2YgYnJlYWRjcnVtYlxuICAgKi9cbiAgcHJpdmF0ZSBicmVhZGNydW1icyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8QnJlYWRjcnVtYltdPihbXSk7XG4gIHB1YmxpYyBicmVhZGNydW1icyQgPSB0aGlzLmJyZWFkY3J1bWJzLmFzT2JzZXJ2YWJsZSgpO1xuXG4gIHByaXZhdGUgcGF0aFBhcmFtUHJlZml4ID0gJzonO1xuICBwcml2YXRlIHBhdGhQYXJhbVJlZ2V4SWRlbnRpZmllciA9ICcvOlteL10rJztcbiAgcHJpdmF0ZSBwYXRoUGFyYW1SZWdleFJlcGxhY2VyID0gJy9bXi9dKyc7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIpIHtcbiAgICB0aGlzLnNldEJhc2VCcmVhZGNydW1iKCk7XG4gICAgdGhpcy5kZXRlY3RSb3V0ZUNoYW5nZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYnJlYWRjcnVtYiBsYWJlbCBvciBvcHRpb25zIGZvciAtXG4gICAqXG4gICAqIHJvdXRlIChjb21wbGV0ZSByb3V0ZSBwYXRoKS4gcm91dGUgY2FuIGJlIHBhc3NlZCB0aGUgc2FtZSB3YXkgeW91IGRlZmluZSBhbmd1bGFyIHJvdXRlc1xuICAgKiAxKSB1cGRhdGUgbGFiZWwgRXg6IHNldCgnL21lbnRvcicsICdNZW50b3InKSwgc2V0KCcvbWVudG9yLzppZCcsICdNZW50b3IgRGV0YWlscycpXG4gICAqIDIpIGNoYW5nZSB2aXNpYmlsaXR5IEV4OiBzZXQoJy9tZW50b3IvOmlkL2VkaXQnLCB7IHNraXA6IHRydWUgfSlcbiAgICogMykgYWRkIGluZm8gRXg6IHNldCgnL21lbnRvci86aWQvZWRpdCcsIHsgaW5mbzogeyBpY29uOiAnZWRpdCcsIGljb25Db2xvcjogJ2JsdWUnIH0gfSlcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIE9SIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICpcbiAgICogYWxpYXMgKHByZWZpeGVkIHdpdGggJ0AnKS4gYnJlYWRjcnVtYiBhbGlhcyBpcyB1bmlxdWUgZm9yIGEgcm91dGVcbiAgICogMSkgdXBkYXRlIGxhYmVsIEV4OiBzZXQoJ0BtZW50b3InLCAnRW5hYmxlcicpXG4gICAqIDIpIGNoYW5nZSB2aXNpYmlsaXR5IEV4OiBzZXQoJ0BtZW50b3JFZGl0JywgeyBza2lwOiB0cnVlIH0pXG4gICAqIDMpIGFkZCBpbmZvIEV4OiBzZXQoJ0BtZW50b3JFZGl0JywgeyBpbmZvOiB7IGljb246ICdlZGl0JywgaWNvbkNvbG9yOiAnYmx1ZScgfSB9KVxuICAgKi9cbiAgc2V0KHBhdGhPckFsaWFzOiBzdHJpbmcsIGJyZWFkY3J1bWI6IHN0cmluZyB8IEJyZWFkY3J1bWIpIHtcbiAgICBpZiAoIXRoaXMudmFsaWRhdGVBcmd1bWVudHMocGF0aE9yQWxpYXMsIGJyZWFkY3J1bWIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBicmVhZGNydW1iID09PSAnc3RyaW5nJykge1xuICAgICAgYnJlYWRjcnVtYiA9IHtcbiAgICAgICAgbGFiZWw6IGJyZWFkY3J1bWJcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHBhdGhPckFsaWFzLnN0YXJ0c1dpdGgoJ0AnKSkge1xuICAgICAgdGhpcy51cGRhdGVTdG9yZSh7IC4uLmJyZWFkY3J1bWIsIGFsaWFzOiBwYXRoT3JBbGlhcy5zbGljZSgxKSB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgYnJlYWRjcnVtYkV4dHJhUHJvcHMgPSB0aGlzLmJ1aWxkUm91dGVSZWdFeHAocGF0aE9yQWxpYXMpO1xuICAgICAgdGhpcy51cGRhdGVTdG9yZSh7IC4uLmJyZWFkY3J1bWIsIC4uLmJyZWFkY3J1bWJFeHRyYVByb3BzIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0QmFzZUJyZWFkY3J1bWIoKSB7XG4gICAgY29uc3QgYmFzZUNvbmZpZyA9IHRoaXMucm91dGVyLmNvbmZpZy5maW5kKHBhdGhDb25maWcgPT4gcGF0aENvbmZpZy5wYXRoID09PSAnJyk7XG4gICAgaWYgKGJhc2VDb25maWcgJiYgYmFzZUNvbmZpZy5kYXRhKSB7XG4gICAgICBsZXQgeyBsYWJlbCwgYWxpYXMsIHNraXAgPSBmYWxzZSwgaW5mbywgZGlzYWJsZSA9IGZhbHNlIH0gPSB0aGlzLmdldEJyZWFkY3J1bWJPcHRpb25zKGJhc2VDb25maWcuZGF0YSk7XG5cbiAgICAgIGxldCBpc0F1dG9HZW5lcmF0ZWRMYWJlbCA9IGZhbHNlO1xuICAgICAgaWYgKHR5cGVvZiBsYWJlbCAhPT0gJ3N0cmluZycgJiYgIWxhYmVsKSB7XG4gICAgICAgIGxhYmVsID0gJyc7XG4gICAgICAgIGlzQXV0b0dlbmVyYXRlZExhYmVsID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5iYXNlQnJlYWRjcnVtYiA9IHtcbiAgICAgICAgbGFiZWwsXG4gICAgICAgIGFsaWFzLFxuICAgICAgICBza2lwLFxuICAgICAgICBkaXNhYmxlLFxuICAgICAgICBpbmZvLFxuICAgICAgICByb3V0ZUxpbms6IHRoaXMuYmFzZUhyZWYsXG4gICAgICAgIGlzQXV0b0dlbmVyYXRlZExhYmVsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBXaGVuZXZlciByb3V0ZSBjaGFuZ2VzIGJ1aWxkIGJyZWFkY3J1bWIgbGlzdCBhZ2FpblxuICAgKi9cbiAgcHJpdmF0ZSBkZXRlY3RSb3V0ZUNoYW5nZXMoKSB7XG4gICAgdGhpcy5yb3V0ZXIuZXZlbnRzXG4gICAgICAucGlwZShcbiAgICAgICAgZmlsdGVyKGV2ZW50ID0+IGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCksXG4gICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgICB0aGlzLnByZXZpb3VzQnJlYWRjcnVtYnMgPSB0aGlzLmN1cnJlbnRCcmVhZGNydW1icztcblxuICAgICAgICB0aGlzLmN1cnJlbnRCcmVhZGNydW1icyA9IHRoaXMuYmFzZUJyZWFkY3J1bWIgPyBbdGhpcy5iYXNlQnJlYWRjcnVtYl0gOiBbXTtcbiAgICAgICAgdGhpcy5wcmVwYXJlQnJlYWRjcnVtYkxpc3QodGhpcy5hY3RpdmF0ZWRSb3V0ZS5yb290LCB0aGlzLmJhc2VIcmVmKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBwcmVwYXJlQnJlYWRjcnVtYkxpc3QoYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLCByb3V0ZUxpbmtQcmVmaXg6IHN0cmluZyk6IEJyZWFkY3J1bWJbXSB7XG4gICAgaWYgKGFjdGl2YXRlZFJvdXRlLnJvdXRlQ29uZmlnICYmIGFjdGl2YXRlZFJvdXRlLnJvdXRlQ29uZmlnLnBhdGgpIHtcbiAgICAgIGNvbnN0IGJyZWFkY3J1bWJJdGVtID0gdGhpcy5wcmVwYXJlQnJlYWRjcnVtYkl0ZW0oYWN0aXZhdGVkUm91dGUsIHJvdXRlTGlua1ByZWZpeCk7XG4gICAgICB0aGlzLmN1cnJlbnRCcmVhZGNydW1icy5wdXNoKGJyZWFkY3J1bWJJdGVtKTtcblxuICAgICAgaWYgKGFjdGl2YXRlZFJvdXRlLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJlcGFyZUJyZWFkY3J1bWJMaXN0KGFjdGl2YXRlZFJvdXRlLmZpcnN0Q2hpbGQsIGJyZWFkY3J1bWJJdGVtLnJvdXRlTGluayArICcvJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChhY3RpdmF0ZWRSb3V0ZS5maXJzdENoaWxkKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcmVwYXJlQnJlYWRjcnVtYkxpc3QoYWN0aXZhdGVkUm91dGUuZmlyc3RDaGlsZCwgcm91dGVMaW5rUHJlZml4KTtcbiAgICB9XG4gICAgLy8gcmVtb3ZlIGJyZWFkY3J1bWIgaXRlbXMgdGhhdCBuZWVkcyB0byBiZSBoaWRkZW4gb3IgZG9uJ3QgaGF2ZSBhIGxhYmVsXG4gICAgY29uc3QgYnJlYWRjcnVtYnNUb1Nob3cgPSB0aGlzLmN1cnJlbnRCcmVhZGNydW1icy5maWx0ZXIoaXRlbSA9PiAhaXRlbS5za2lwKTtcblxuICAgIHRoaXMuYnJlYWRjcnVtYnMubmV4dChicmVhZGNydW1ic1RvU2hvdyk7XG4gIH1cblxuICBwcml2YXRlIHByZXBhcmVCcmVhZGNydW1iSXRlbShhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsIHJvdXRlTGlua1ByZWZpeDogc3RyaW5nKTogQnJlYWRjcnVtYiB7XG4gICAgY29uc3QgeyBwYXRoLCBicmVhZGNydW1iIH0gPSB0aGlzLnBhcnNlUm91dGVEYXRhKGFjdGl2YXRlZFJvdXRlLnJvdXRlQ29uZmlnKTtcblxuICAgIC8vIGluIGNhc2Ugb2YgcGF0aCBwYXJhbSBnZXQgdGhlIHJlc29sdmVkIGZvciBwYXJhbVxuICAgIGNvbnN0IHJlc29sdmVkUGF0aCA9IHRoaXMucmVzb2x2ZVBhdGhQYXJhbShwYXRoLCBhY3RpdmF0ZWRSb3V0ZSk7XG4gICAgY29uc3Qgcm91dGVMaW5rID0gYCR7cm91dGVMaW5rUHJlZml4fSR7cmVzb2x2ZWRQYXRofWA7XG5cbiAgICBsZXQgeyBsYWJlbCwgYWxpYXMsIHNraXAsIGRpc2FibGUsIGluZm8gfSA9IHRoaXMuZ2V0RnJvbVN0b3JlKGJyZWFkY3J1bWIuYWxpYXMsIHJvdXRlTGluayk7XG4gICAgbGV0IGlzQXV0b0dlbmVyYXRlZExhYmVsID0gZmFsc2U7XG5cbiAgICBpZiAodHlwZW9mIGxhYmVsICE9PSAnc3RyaW5nJykge1xuICAgICAgaWYgKHR5cGVvZiBicmVhZGNydW1iLmxhYmVsID09PSAnc3RyaW5nJykge1xuICAgICAgICBsYWJlbCA9IGJyZWFkY3J1bWIubGFiZWw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsYWJlbCA9IHJlc29sdmVkUGF0aDtcbiAgICAgICAgaXNBdXRvR2VuZXJhdGVkTGFiZWwgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBsYWJlbCxcbiAgICAgIGFsaWFzOiBhbGlhcyB8fCBicmVhZGNydW1iLmFsaWFzLFxuICAgICAgc2tpcDogc2tpcCB8fCBicmVhZGNydW1iLnNraXAsXG4gICAgICBkaXNhYmxlOiBkaXNhYmxlIHx8IGJyZWFkY3J1bWIuZGlzYWJsZSxcbiAgICAgIGluZm86IGluZm8gfHwgYnJlYWRjcnVtYi5pbmZvLFxuICAgICAgcm91dGVMaW5rLFxuICAgICAgaXNBdXRvR2VuZXJhdGVkTGFiZWwsXG4gICAgICAuLi50aGlzLnJlc29sdmVRdWVyeVBhcmFtKHJvdXRlTGluaywgYWN0aXZhdGVkUm91dGUpXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3IgYSBzcGVjaWZpYyByb3V0ZSwgYnJlYWRjcnVtYiBjYW4gYmUgZGVmaW5lZCBlaXRoZXIgb24gcGFyZW50IGRhdGEgT1IgaXQncyBjaGlsZCh3aGljaCBoYXMgZW1wdHkgcGF0aCkgZGF0YVxuICAgKiBXaGVuIGJvdGggYXJlIGRlZmluZWQsIGNoaWxkIHRha2VzIHByZWNlZGVuY2VcbiAgICpcbiAgICogRXg6IEJlbG93IHdlIGFyZSBzZXR0aW5nIGJyZWFkY3J1bWIgb24gYm90aCBwYXJlbnQgYW5kIGNoaWxkLlxuICAgKiBTbywgY2hpbGQgdGFrZXMgcHJlY2VkZW5jZSBhbmQgXCJEZWZpbmVkIE9uIENoaWxkXCIgaXMgZGlzcGxheWVkIGZvciB0aGUgcm91dGUgJ2hvbWUnXG4gICAqIHsgcGF0aDogJ2hvbWUnLCBsb2FkQ2hpbGRyZW46ICcuL2hvbWUvaG9tZS5tb2R1bGUjSG9tZU1vZHVsZScgLCBkYXRhOiB7YnJlYWRjcnVtYjogXCJEZWZpbmVkIE9uIE1vZHVsZVwifX1cbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBTkRcbiAgICogY2hpbGRyZW46IFtcbiAgICogICB7IHBhdGg6ICcnLCBjb21wb25lbnQ6IFNob3dVc2VyQ29tcG9uZW50LCBkYXRhOiB7YnJlYWRjcnVtYjogXCJEZWZpbmVkIE9uIENoaWxkXCIgfVxuICAgKiBdXG4gICAqL1xuICBwcml2YXRlIHBhcnNlUm91dGVEYXRhKHJvdXRlQ29uZmlnKSB7XG4gICAgY29uc3QgeyBwYXRoLCBkYXRhID0ge30gfSA9IHJvdXRlQ29uZmlnO1xuICAgIGNvbnN0IGJyZWFkY3J1bWIgPSB0aGlzLm1lcmdlV2l0aEJhc2VDaGlsZERhdGEocm91dGVDb25maWcsIHsgLi4uZGF0YSB9KTtcblxuICAgIHJldHVybiB7IHBhdGgsIGJyZWFkY3J1bWIgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RnJvbVN0b3JlKGJyZWFkY3J1bWJBbGlhczogc3RyaW5nLCByb3V0ZUxpbms6IHN0cmluZyk6IEJyZWFkY3J1bWIge1xuICAgIGxldCBtYXRjaGluZ0l0ZW07XG4gICAgaWYgKGJyZWFkY3J1bWJBbGlhcykge1xuICAgICAgbWF0Y2hpbmdJdGVtID0gdGhpcy5keW5hbWljQnJlYWRjcnVtYlN0b3JlLmZpbmQoaXRlbSA9PiBpdGVtLmFsaWFzID09PSBicmVhZGNydW1iQWxpYXMpO1xuICAgIH1cblxuICAgIGlmICghbWF0Y2hpbmdJdGVtICYmIHJvdXRlTGluaykge1xuICAgICAgbWF0Y2hpbmdJdGVtID0gdGhpcy5keW5hbWljQnJlYWRjcnVtYlN0b3JlLmZpbmQoaXRlbSA9PiB7XG4gICAgICAgIHJldHVybiAoaXRlbS5yb3V0ZUxpbmsgJiYgaXRlbS5yb3V0ZUxpbmsgPT09IHJvdXRlTGluaykgfHwgKGl0ZW0ucm91dGVSZWdleCAmJiBuZXcgUmVnRXhwKGl0ZW0ucm91dGVSZWdleCkudGVzdChyb3V0ZUxpbmsgKyAnLycpKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBtYXRjaGluZ0l0ZW0gfHwge307XG4gIH1cblxuICAvKipcbiAgICogVG8gdXBkYXRlIGJyZWFkY3J1bWIgbGFiZWwgZm9yIGEgcm91dGUgd2l0aCBwYXRoIHBhcmFtLCB3ZSBuZWVkIHJlZ2V4IHRoYXQgbWF0Y2hlcyByb3V0ZS5cbiAgICogSW5zdGVhZCBvZiB1c2VyIHByb3ZpZGluZyByZWdleCwgd2UgaGVscCBpbiBwcmVwYXJpbmcgcmVnZXggZHluYW1pY2FsbHlcbiAgICpcbiAgICogRXg6IHJvdXRlIGRlY2xhcmF0aW9uIC0gcGF0aDogJy9tZW50b3IvOmlkJ1xuICAgKiBicmVhZGNydW1iU2VydmljZS5zZXQoJy9tZW50b3IvOmlkJywgJ1VkYXknKTtcbiAgICogJy9tZW50b3IvMicgT1IgJ21lbnRvci9hZGEnIHdlIHNob3VsZCB1c2UgJ1VkYXknIGFzIGxhYmVsXG4gICAqXG4gICAqIHJlZ2V4IHN0cmluZyBpcyBidWlsdCwgaWYgcm91dGUgaGFzIHBhdGggcGFyYW1zKGNvbnRhaW5zIHdpdGggJzonKVxuICAgKi9cbiAgcHJpdmF0ZSBidWlsZFJvdXRlUmVnRXhwKHBhdGgpIHtcbiAgICAvLyBlbnN1cmUgbGVhZGluZyBzbGFzaCBpcyBwcm92aWRlZCBpbiB0aGUgcGF0aFxuICAgIGlmICghcGF0aC5zdGFydHNXaXRoKCcvJykpIHtcbiAgICAgIHBhdGggPSAnLycgKyBwYXRoO1xuICAgIH1cblxuICAgIGlmIChwYXRoLmluY2x1ZGVzKHRoaXMucGF0aFBhcmFtUHJlZml4KSkge1xuICAgICAgLy8gcmVwbGFjZSBtYXRoaW5nIHBhdGggcGFyYW0gd2l0aCBhIHJlZ2V4XG4gICAgICAvLyAnL21lbnRvci86aWQnIGJlY29tZXMgJy9tZW50b3IvW14vXScsIHdoaWNoIGZ1cnRoZXIgd2lsbCBiZSBtYXRjaGVkIGluIHVwZGF0ZVN0b3JlXG4gICAgICBjb25zdCByb3V0ZVJlZ2V4ID0gcGF0aC5yZXBsYWNlKG5ldyBSZWdFeHAodGhpcy5wYXRoUGFyYW1SZWdleElkZW50aWZpZXIsICdnJyksIHRoaXMucGF0aFBhcmFtUmVnZXhSZXBsYWNlcik7XG4gICAgICByZXR1cm4geyByb3V0ZVJlZ2V4IH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7IHJvdXRlTGluazogcGF0aCB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY3VycmVudCBicmVhZGNydW1iIGRlZmluaXRpb24gYW5kIGVtaXQgYSBuZXcgc3RyZWFtIG9mIGJyZWFkY3J1bWJzXG4gICAqIEFsc28gdXBkYXRlIHRoZSBzdG9yZSB0byByZXVzZSBkeW5hbWljIGRlY2xhcmF0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVTdG9yZShicmVhZGNydW1iKSB7XG4gICAgY29uc3QgeyBicmVhZGNydW1iSXRlbUluZGV4LCBzdG9yZUl0ZW1JbmRleCB9ID0gdGhpcy5nZXRCcmVhZGNydW1iSW5kZXhlcyhicmVhZGNydW1iKTtcblxuICAgIC8vIGlmIGJyZWFkY3J1bWIgaXMgcHJlc2VudCBpbiBjdXJyZW50IGJyZWFkY3J1bWJzIHVwZGF0ZSBpdCBhbmQgZW1pdCBuZXcgc3RyZWFtXG4gICAgaWYgKGJyZWFkY3J1bWJJdGVtSW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5jdXJyZW50QnJlYWRjcnVtYnNbYnJlYWRjcnVtYkl0ZW1JbmRleF0gPSB7IC4uLnRoaXMuY3VycmVudEJyZWFkY3J1bWJzW2JyZWFkY3J1bWJJdGVtSW5kZXhdLCAuLi5icmVhZGNydW1iIH07XG4gICAgICBjb25zdCBicmVhZGNydW1ic1RvU2hvdyA9IHRoaXMuY3VycmVudEJyZWFkY3J1bWJzLmZpbHRlcihpdGVtID0+ICFpdGVtLnNraXApO1xuICAgICAgdGhpcy5icmVhZGNydW1icy5uZXh0KFsuLi5icmVhZGNydW1ic1RvU2hvd10pO1xuICAgIH1cblxuICAgIC8vIElmIHRoZSBzdG9yZSBhbHJlYWR5IGhhcyB0aGlzIHJvdXRlIGRlZmluaXRpb24gdXBkYXRlIGl0LCBlbHNlIGFkZFxuICAgIGlmIChzdG9yZUl0ZW1JbmRleCA+IC0xKSB7XG4gICAgICB0aGlzLmR5bmFtaWNCcmVhZGNydW1iU3RvcmVbc3RvcmVJdGVtSW5kZXhdID0geyAuLi50aGlzLmR5bmFtaWNCcmVhZGNydW1iU3RvcmVbc3RvcmVJdGVtSW5kZXhdLCAuLi5icmVhZGNydW1iIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZHluYW1pY0JyZWFkY3J1bWJTdG9yZS5wdXNoKGJyZWFkY3J1bWIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0QnJlYWRjcnVtYkluZGV4ZXMoYnJlYWRjcnVtYik6IGFueSB7XG4gICAgY29uc3QgeyBhbGlhcywgcm91dGVMaW5rLCByb3V0ZVJlZ2V4IH0gPSBicmVhZGNydW1iO1xuICAgIGxldCBpbmRleE1hcCA9IHt9O1xuICAgIC8vIGlkZW50aWZ5IG1hY3RoaW5nIGJyZWFkY3J1bWIgYW5kIHN0b3JlIGl0ZW1cbiAgICBpZiAoYWxpYXMpIHtcbiAgICAgIGluZGV4TWFwID0gdGhpcy5nZXRCcmVhZGNydW1iSW5kZXhlc0J5VHlwZSgnYWxpYXMnLCBhbGlhcyk7XG4gICAgfSBlbHNlIGlmIChyb3V0ZUxpbmspIHtcbiAgICAgIGluZGV4TWFwID0gdGhpcy5nZXRCcmVhZGNydW1iSW5kZXhlc0J5VHlwZSgncm91dGVMaW5rJywgcm91dGVMaW5rKTtcbiAgICB9IGVsc2UgaWYgKHJvdXRlUmVnZXgpIHtcbiAgICAgIGluZGV4TWFwID0gdGhpcy5nZXRCcmVhZGNydW1iSW5kZXhlc0J5VHlwZSgncm91dGVSZWdleCcsIHJvdXRlUmVnZXgpO1xuICAgIH1cbiAgICByZXR1cm4gaW5kZXhNYXA7XG4gIH1cblxuICBwcml2YXRlIGdldEJyZWFkY3J1bWJJbmRleGVzQnlUeXBlKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG4gICAgbGV0IGJyZWFkY3J1bWJJdGVtSW5kZXg6IG51bWJlcjtcbiAgICBpZiAoa2V5ICE9PSAncm91dGVSZWdleCcpIHtcbiAgICAgIGJyZWFkY3J1bWJJdGVtSW5kZXggPSB0aGlzLmN1cnJlbnRCcmVhZGNydW1icy5maW5kSW5kZXgoaXRlbSA9PiB2YWx1ZSA9PT0gaXRlbVtrZXldKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnJlYWRjcnVtYkl0ZW1JbmRleCA9IHRoaXMuY3VycmVudEJyZWFkY3J1bWJzLmZpbmRJbmRleChpdGVtID0+IG5ldyBSZWdFeHAodmFsdWUpLnRlc3QoaXRlbS5yb3V0ZUxpbmspKTtcbiAgICB9XG4gICAgY29uc3Qgc3RvcmVJdGVtSW5kZXggPSB0aGlzLmR5bmFtaWNCcmVhZGNydW1iU3RvcmUuZmluZEluZGV4KGl0ZW0gPT4gdmFsdWUgPT09IGl0ZW1ba2V5XSk7XG5cbiAgICByZXR1cm4geyBicmVhZGNydW1iSXRlbUluZGV4LCBzdG9yZUl0ZW1JbmRleCB9O1xuICB9XG5cbiAgcHJpdmF0ZSByZXNvbHZlUGF0aFBhcmFtKHBhdGg6IHN0cmluZywgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlKSB7XG4gICAgLy8gaWYgdGhlIHBhdGggc2VnbWVudCBpcyBhIHJvdXRlIHBhcmFtLCByZWFkIHRoZSBwYXJhbSB2YWx1ZSBmcm9tIHVybFxuICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgodGhpcy5wYXRoUGFyYW1QcmVmaXgpKSB7XG4gICAgICByZXR1cm4gYWN0aXZhdGVkUm91dGUuc25hcHNob3QucGFyYW1zW3BhdGguc2xpY2UoMSldO1xuICAgIH1cbiAgICByZXR1cm4gcGF0aDtcbiAgfVxuXG4gIHByaXZhdGUgcmVzb2x2ZVF1ZXJ5UGFyYW0ocm91dGVMaW5rOiBzdHJpbmcsIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSkge1xuICAgIGNvbnN0IHByZXZpb3VzQnJlYWRjcnVtYiA9IHRoaXMucHJldmlvdXNCcmVhZGNydW1icy5maW5kKGl0ZW0gPT4gaXRlbS5yb3V0ZUxpbmsgPT09IHJvdXRlTGluaykgfHwge307XG4gICAgY29uc3QgeyBxdWVyeVBhcmFtcywgZnJhZ21lbnQgfSA9IGFjdGl2YXRlZFJvdXRlLnNuYXBzaG90O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHF1ZXJ5UGFyYW1zOiBPYmplY3Qua2V5cyhxdWVyeVBhcmFtcykubGVuZ3RoID4gMCA/IHsgLi4ucXVlcnlQYXJhbXMgfSA6IHByZXZpb3VzQnJlYWRjcnVtYi5xdWVyeVBhcmFtcyxcbiAgICAgIGZyYWdtZW50OiBmcmFnbWVudCB8fCBwcmV2aW91c0JyZWFkY3J1bWIuZnJhZ21lbnRcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIGdldCBlbXB0eSBjaGlsZHJlbiBvZiBhIG1vZHVsZSBvciBDb21wb25lbnQuIEVtcHR5IGNoaWxkIGlzIHRoZSBvbmUgd2l0aCBwYXRoOiAnJ1xuICAgKiBXaGVuIHBhcmVudCBhbmQgaXQncyBjaGlsZHJlbiAodGhhdCBoYXMgZW1wdHkgcm91dGUgcGF0aCkgZGVmaW5lIGRhdGFcbiAgICogbWVyZ2UgdGhlbSBib3RoIHdpdGggY2hpbGQgdGFraW5nIHByZWNlZGVuY2VcbiAgICovXG4gIHByaXZhdGUgbWVyZ2VXaXRoQmFzZUNoaWxkRGF0YShyb3V0ZUNvbmZpZywgZGF0YSk6IEJyZWFkY3J1bWIge1xuICAgIGlmICghcm91dGVDb25maWcpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldEJyZWFkY3J1bWJPcHRpb25zKGRhdGEpO1xuICAgIH1cblxuICAgIGxldCBiYXNlQ2hpbGQ7XG4gICAgaWYgKHJvdXRlQ29uZmlnLmxvYWRDaGlsZHJlbikge1xuICAgICAgLy8gVG8gaGFuZGxlIGEgbW9kdWxlIHdpdGggZW1wdHkgY2hpbGQgcm91dGVcbiAgICAgIGJhc2VDaGlsZCA9IHJvdXRlQ29uZmlnLl9sb2FkZWRDb25maWcucm91dGVzLmZpbmQocm91dGUgPT4gcm91dGUucGF0aCA9PT0gJycpO1xuICAgIH0gZWxzZSBpZiAocm91dGVDb25maWcuY2hpbGRyZW4pIHtcbiAgICAgIC8vIFRvIGhhbmRsZSBhIGNvbXBvbmVudCB3aXRoIGVtcHR5IGNoaWxkIHJvdXRlXG4gICAgICBiYXNlQ2hpbGQgPSByb3V0ZUNvbmZpZy5jaGlsZHJlbi5maW5kKHJvdXRlID0+IHJvdXRlLnBhdGggPT09ICcnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYmFzZUNoaWxkICYmIGJhc2VDaGlsZC5kYXRhXG4gICAgICA/IHRoaXMubWVyZ2VXaXRoQmFzZUNoaWxkRGF0YShiYXNlQ2hpbGQsIHtcbiAgICAgICAgICAuLi50aGlzLmdldEJyZWFkY3J1bWJPcHRpb25zKGRhdGEpLFxuICAgICAgICAgIC4uLnRoaXMuZ2V0QnJlYWRjcnVtYk9wdGlvbnMoYmFzZUNoaWxkLmRhdGEpXG4gICAgICAgIH0pXG4gICAgICA6IHRoaXMuZ2V0QnJlYWRjcnVtYk9wdGlvbnMoZGF0YSk7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlQXJndW1lbnRzKHBhdGhPckFsaWFzLCBicmVhZGNydW1iKSB7XG4gICAgaWYgKHBhdGhPckFsaWFzID09PSBudWxsIHx8IHBhdGhPckFsaWFzID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgZmlyc3QgYXJndW1lbnQuIFBsZWFzZSBwYXNzIGEgcm91dGUgcGF0aCBvciBhIGJyZWFkY3J1bWIgYWxpYXMuJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChicmVhZGNydW1iID09PSBudWxsIHx8IGJyZWFkY3J1bWIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBzZWNvbmQgYXJndW1lbnQuIFBsZWFzZSBwYXNzIGEgc3RyaW5nIG9yIGFuIE9iamVjdCB3aXRoIGJyZWFkY3J1bWIgb3B0aW9ucy4nKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogYnJlYWRjcnVtYiBjYW4gYmUgcGFzc2VkIGEgbGFiZWwgb3IgYW4gb3B0aW9ucyBvYmplY3RcbiAgICogSWYgcGFzc2VkIGFzIGEgc3RyaW5nIGNvbnZlcnQgdG8gYnJlYWRjcnVtYiBvcHRpb25zIG9iamVjdFxuICAgKi9cbiAgcHJpdmF0ZSBnZXRCcmVhZGNydW1iT3B0aW9ucyhkYXRhKSB7XG4gICAgbGV0IHsgYnJlYWRjcnVtYiB9ID0gZGF0YTtcbiAgICBpZiAodHlwZW9mIGJyZWFkY3J1bWIgPT09ICdzdHJpbmcnIHx8ICFicmVhZGNydW1iKSB7XG4gICAgICBicmVhZGNydW1iID0ge1xuICAgICAgICBsYWJlbDogYnJlYWRjcnVtYlxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGJyZWFkY3J1bWI7XG4gIH1cbn1cbiJdfQ==